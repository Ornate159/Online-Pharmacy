{% extends 'shop/style.html' %}
{% block title %} Checkout {% endblock %}
{% block body%}
<div style="background-color: #f9f9f9;">
{% load static %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KyZXEAg3QhqLMpG8r+8fhAXLRk2vvoC2f3B09zVXn8CA5QIVfZOJ3BCsw2P0p/We" crossorigin="anonymous">
<div class="container">
  <div class="row">
      <div class="col-md-6 mx-auto">
          <div class="card shadow-lg">
              <div class="card-body">
                  <h2 class="text-center mb-4">Checkout Form</h2>
                  <div>
                      <h4 class="mb-3">Billing Address</h4>
                      <form class="needs-validation" novalidate>
                          <div class="row g-3">
                              <div class="col-md-6">
                                  <label for="firstName" class="form-label">First Name</label>
                                  <input type="text" class="form-control" id="firstName" placeholder="" value="" required>
                                  <div class="invalid-feedback">
                                      Valid first name is required.
                                  </div>
                              </div>
                              <div class="col-md-6">
                                  <label for="lastName" class="form-label">Last Name</label>
                                  <input type="text" class="form-control" id="lastName" placeholder="" value="" required>
                                  <div class="invalid-feedback">
                                      Valid last name is required.
                                  </div>
                              </div>
                              <div class="col-12">
                                  <label for="email" class="form-label">Email <span class="text-muted">(Optional)</span></label>
                                  <input type="email" class="form-control" id="email" placeholder="you@example.com">
                                  <div class="invalid-feedback">
                                      Please enter a valid email address for shipping updates.
                                  </div>
                              </div>
                              <div class="col-12">
                                  <label for="address" class="form-label">Address</label>
                                  <input type="text" class="form-control" id="address" placeholder="1234 Main St" required>
                                  <div class="invalid-feedback">
                                      Please enter your shipping address.
                                  </div>
                              </div>
                              <div class="col-12">
                                  <label for="address2" class="form-label">Phone No. <span class="text-muted">(Optional)</span></label>
                                  <input type="text" class="form-control" id="address2" placeholder="01XXXXXXXXX">
                              </div>
                              <div class="col-12">
                                  <hr class="my-4">
                                  <h4 class="mb-3">Your Cart</h4>
                                  <div>
                                    <ul class="list-group"  id="items">
                                  
                                    </ul>
                                  </div>
                                  <hr class="my-4">
                                  <h4 class="mb-3">Payment</h4>
                                  <div class="d-block my-3">
                                      <div class="form-check">
                                          <input id="credit" name="paymentMethod" type="radio" class="form-check-input" checked required>
                                          <label class="form-check-label" for="credit">bKash</label>
                                      </div>
                                      <div class="form-check">
                                          <input id="debit" name="paymentMethod" type="radio" class="form-check-input" required>
                                          <label class="form-check-label" for="debit">Nagad</label>
                                      </div>
                                      <div class="form-check">
                                          <input id="paypal" name="paymentMethod" type="radio" class="form-check-input" required>
                                          <label class="form-check-label" for="paypal">Home Delivery</label>
                                      </div>
                                  </div>
                              </div>
                          </div>
                          <button id="checkoutButton" class="btn btn-primary btn-lg btn-block" type="submit">Continue to Payment</button>
                      </form>
                  </div>
              </div>
          </div>
      </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-U1DAWAznBHeqEIlVSCgzq+c9gqGAJn5c/t99JyeKa9xxaYpSvHU5awsuZVVFIhvj" crossorigin="anonymous"></script>


{% endblock %}
</div>

{% block javascript %}
<script>
const checkoutButton = document.getElementById('checkoutButton');
        const paymentMethods = document.querySelectorAll('input[name="paymentMethod"]');

        paymentMethods.forEach((method) => {
            method.addEventListener('change', function() {
                if (method.id === 'paypal') {
                    checkoutButton.innerText = 'Place Order';
                    cart = JSON.parse(localStorage.getItem('cart'));
                              for (var item in cart) {
                                  document.getElementById('div' + item).innerHTML = '<button id="' + item + '" class="btn btn-primary cart">Add To Cart</button>';
                              }
                              localStorage.clear();
                              cart = {};
                } else {
                    checkoutButton.innerText = 'Continue to Payment';
                }
            });
        });

        checkoutButton.addEventListener('click', function(e) {
            e.preventDefault(); // Prevent form submission
            if (checkoutButton.innerText === 'Place Order') {
                alert('Order Placed');
                window.location.href = '/shop';
            }
        });

  if (localStorage.getItem('cart') == null) {
    var cart = {};
} else {
    cart = JSON.parse(localStorage.getItem('cart'));
}
console.log(cart)
var sum=0;
if ($.isEmptyObject(cart)){
    mystr=`<p>Your cart is empty. Please add some items first!</p>>`
    $('#items').append(mystr);
}
for(item in cart){
    let name=cart[item][1];
    let qty=cart[item][0];
    sum=sum+qty;
    mystr=`<li class="list-group-item d-flex justify-content-between lh-condensed">
          <div>
            <h6 class="my-0">${name}</h6>
          </div>
          <span class="text-muted">${qty}</span>
        </li>`
    $('#items').append(mystr);
}

document.getElementById('cart').innerHTML = sum;
</script>
{% endblock %}